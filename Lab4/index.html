<!DOCTYPE html>

<html>
<head>
 <title>Introducing Tacoma</title>

    	<script src='https://api.mapbox.com/mapbox-gl-js/v1.12.0/mapbox-gl.js'></script>
      <link href='https://api.mapbox.com/mapbox-gl-js/v1.12.0/mapbox-gl.css' rel='stylesheet' />
      <link href="style.css" rel="stylesheet" type="text/css">
      <!-- chart -->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.min.js"></script>
      <!-- Geocoder -->
			<script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.5.1/mapbox-gl-geocoder.min.js"></script>
			<link	rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.5.1/mapbox-gl-geocoder.css"
			type="text/css"/>
			<!-- Promise polyfill script required to use Mapbox GL Geocoder in IE 11 -->
			<script src="https://cdn.jsdelivr.net/npm/es6-promise@4/dist/es6-promise.min.js"></script>
			<script src="https://cdn.jsdelivr.net/npm/es6-promise@4/dist/es6-promise.auto.min.js"></script>

</head>


<body>

<!-- 1st Map -->
    <h1 class="headers"><center>Welcome to the City of Tacoma</center></h1>
    <div id='map'></div>
    <div class='map-overlay' id='features'><h2>Tacoma Population</h2><div id='pd'><p>Hover over a block group!</p></div></div>
    <div class='map-overlay' id='legend'><b>Population Density<b></div>

<!-- This is where charts start -->
		<div class="wrapper">
			<h1>Tacoma Demographics</h1>
			<h2>Data from Census Reporter</h2>
      <canvas id="myChart" width="2000" height="1000"></canvas>
    </div>


<!-- 2nd Map -->
    <h1 class="headers"><center>Places to Visit in Tacoma</center></h1>
    <div id="menu"></div>
		<div id='map2'></div>
      <ul>
      <li><p>This map depicts blahblahblah </p></li>
      <li><p>Click on the points for more information and click on the menu in the left-top to turn on&off the points. Also, type in address in the "Search" tool in the right-top to find the address of your choice.</p></li>
      <li><p>All data are from <a href="https://gisdata-piercecowa.opendata.arcgis.com/" target="_blank">Pierce County GIS Portal</a>.
      </li></p>
      </ul>
      <br>


    <script>
//copy your access token here
  			mapboxgl.accessToken = 'pk.eyJ1IjoiamthbmcxIiwiYSI6ImNrZ3d5NjR3NDBldzgycW8zdDZ0NTZvYjAifQ.lUQQ9nNNJryYS05ye4FpLA';

  			var map = new mapboxgl.Map({
  			  container: 'map', // HTML container id
  			  style:  'mapbox://styles/jkang1/ckhyszk2s0v5z19mvxomq6ziz', // style URL
  			  center: [-122.4652388, 47.2414268],// starting position as [lng, lat]
  			  zoom: 10.5 // starting zoom
  			});

//Hover Effect
var hoveredBGId = null;

map.on('load', function () {
map.addSource('Tacoma_BGs', {
'type': 'geojson',
'data':
'Geojson/Tacoma_BG.json'
});


// The feature-state dependent fill-opacity expression will render the hover effect
// when a feature's hover state is set to true.
map.addLayer({
'id': 'BG-fills',
'type': 'fill',
'source': 'Tacoma_BGs',
'layout': {},
'paint': {
'fill-color': 'white',
'fill-opacity': [
'case',
['boolean', ['feature-state', 'hover'], false],
1,
0.5
]
}
});

map.addLayer({
'id': 'BG-borders',
'type': 'line',
'source': 'Tacoma_BGs',
'layout': {},
'paint': {
'line-color': '#627BC1',
'line-width': 1.5
}
});

// When the user moves their mouse over the state-fill layer, we'll update the
// feature state for the feature under the mouse.
map.on('mousemove', 'BG-fills', function (e) {
if (e.features.length > 0) {
if (hoveredBGId) {
map.setFeatureState(
{ source: 'Tacoma_BGs', id: hoveredBGId },
{ hover: false }
);
}
hoveredBGId = e.features[0].id;
map.setFeatureState(
{ source: 'Tacoma_BGs', id: hoveredBGId },
{ hover: true }
);
}
});

// When the mouse leaves the state-fill layer, update the feature state of the
// previously hovered feature.
map.on('mouseleave', 'BG-fills', function () {
if (hoveredBGId) {
map.setFeatureState(
{ source: 'Tacoma_BGs', id: hoveredBGId },
{ hover: false }
);
}
hoveredBGId = null;
});

});


//legend
        map.on('load', function() {
          var layers = ['0-606 | Lowest', '606-1000 | Lower', '1000-1500 | Low', '1500-2000 | High', '2000-2500 | Higher', '2500-3000 | Highest'];
          var colors = ['#42fc31', '#d5fb4b', '#fded3a', '#fca22c', '#fe622a', '#c70000'];
          for (i = 0; i < layers.length; i++) {

        var layer = layers[i];
        var color = colors[i];
        var item = document.createElement('div');
        var key = document.createElement('span');
        key.className = 'legend-key';
        key.style.backgroundColor = color;
            var value = document.createElement('span');
        value.innerHTML = layer;
        item.appendChild(key);
        item.appendChild(value);
        legend.appendChild(item);
        }
        });



        map.on('mousemove', function(e) {
        var Tacoma = map.queryRenderedFeatures(e.point, {
        layers: ['Tacoma_Clip']
        });

        if (Tacoma.length > 0) {
        document.getElementById('pd').innerHTML = '<h3><strong>' + Tacoma[0].properties.Population + '</strong> people per Block Group</em></p>';}
        else {document.getElementById('pd').innerHTML = '<p>Hover over a block group!</p>';}
        });

        map.getCanvas().style.cursor = 'default';

  </script>


<!-- Bar Chart -->
<script>
		var ctx = document.getElementById("myChart");
		var myChart = new Chart(ctx, {
		    type: 'bar',
		   data:{
		   labels: ["White", "African American", "Asian", "Hispanic", "Two or More", "Other"],
		        datasets: [{
		            data: [58, 11, 6, 13, 9, 2],
		            backgroundColor: [
		                'rgba(255, 99, 132, 0.2)',
		                'rgba(54, 162, 235, 0.2)',
		                'rgba(255, 206, 86, 0.2)',
		                'rgba(75, 192, 192, 0.2)',
		                'rgba(153, 102, 255, 0.2)',
		                'rgba(255, 159, 64, 0.2)'
		            ],
		            borderColor: [
		                'rgba(255,99,132,1)',
		                'rgba(54, 162, 235, 1)',
		                'rgba(255, 206, 86, 1)',
		                'rgba(75, 192, 192, 1)',
		                'rgba(153, 102, 255, 1)',
		                'rgba(255, 159, 64, 1)'
		            ],
		            borderWidth: 2
		        }]
		},
		    options: {
					legend: {
          display: false
        },
		        scales: {
							xAxes: [{
							  gridLines: {
							    display: false
							  },
							  ticks: {
							    fontFamily: "Cursive",
									fontSize: 13,
							  }
							}],
		            yAxes: [{
		            ticks: {

		                   min: 0,
		                   max: 100,
		                   callback: function(value){return value+ "%"}
		                },

		            }]
		        }
		    }
		});

</script>

<!-- 2nd map -->
<script>
//copy your access token here
      mapboxgl.accessToken = 'pk.eyJ1IjoiamthbmcxIiwiYSI6ImNrZ3d5NjR3NDBldzgycW8zdDZ0NTZvYjAifQ.lUQQ9nNNJryYS05ye4FpLA';

      var map2 = new mapboxgl.Map({
        container: 'map2',// HTML container id
        style:  'mapbox://styles/jkang1/cki5rokm50dmq19s0cdicuu92',// style URL
        center: [-122.4652388, 47.2414268],// starting position as [lng, lat]
        zoom: 10.5 // starting zoom
      });

//Schools

      var geojson ={"type":"FeatureCollection", "features": [
      {"type":"Feature","geometry":{"type":"Point","coordinates":[-122.46797386019246,47.24181419024509]},"properties":{"OBJECTID":10,"NAME":"Bates Technical College - Central Campus","ADDRESS":"2320 S 19TH ST","CITY":"TACOMA","ZIP":"98405","DISTRICT":"NOT APPLICABLE","DIST_NO":"","TYPE":"TECHNICAL","PHONE":"(253) 680-7603","WEBSITE":"https://batestech.edu/","PRS_ID":342,"GRADE":"Higher Education","X_COORD":1151634.216,"Y_COORD":702078.521}},
      {"type":"Feature","geometry":{"type":"Point","coordinates":[-122.44638853983874,47.25150616140254]},"properties":{"OBJECTID":11,"NAME":"Bates Technical College - Downtown Campus","ADDRESS":"1101 S YAKIMA AVE","CITY":"TACOMA","ZIP":"98405","DISTRICT":"NOT APPLICABLE","DIST_NO":"","TYPE":"TECHNICAL","PHONE":"(253) 680-7000","WEBSITE":"https://batestech.edu/","PRS_ID":241,"GRADE":"Higher Education","X_COORD":1157081.4561,"Y_COORD":705479.4874}},
      {"type":"Feature","geometry":{"type":"Point","coordinates":[-122.4664954172474,47.18787255736512]},"properties":{"OBJECTID":12,"NAME":"Bates Technical College - South Campus","ADDRESS":"2201 S 78TH ST","CITY":"TACOMA","ZIP":"98409","DISTRICT":"NOT APPLICABLE","DIST_NO":"","TYPE":"TECHNICAL","PHONE":"(253) 680-7400","WEBSITE":"https://batestech.edu/","PRS_ID":253,"GRADE":"Higher Education","X_COORD":1151510.8788,"Y_COORD":682400.9323}},
      {"type":"Feature","geometry":{"type":"Point","coordinates":[-122.43937819369988,47.25166123209732]},"properties":{"OBJECTID":46,"NAME":"City University","ADDRESS":"1145 BROADWAY PLAZA SUITE 600","CITY":"TACOMA","ZIP":"98402","DISTRICT":"NOT APPLICABLE","DIST_NO":"","TYPE":"UNIVERSITY","PHONE":"(253) 896-3210","WEBSITE":"https://www.cityu.edu/about-cityu/locations-overview/","PRS_ID":365,"GRADE":"Higher Education","X_COORD":1158823.3332,"Y_COORD":705493.151}},
      {"type":"Feature","geometry":{"type":"Point","coordinates":[-122.45492109321204,47.25640912901201]},"properties":{"OBJECTID":91,"NAME":"Evergreen State College","ADDRESS":"1210 6TH AVE","CITY":"TACOMA","ZIP":"98405","DISTRICT":"NOT APPLICABLE","DIST_NO":"","TYPE":"COLLEGE","PHONE":"(253) 680-3000","WEBSITE":"https://www.evergreen.edu/tacoma","PRS_ID":255,"GRADE":"Higher Education","X_COORD":1155007.3684,"Y_COORD":707319.661}},
      {"type":"Feature","geometry":{"type":"Point","coordinates":[-122.43356750130378,47.23584809855413]},"properties":{"OBJECTID":230,"NAME":"School of Urban Ministry - Tacoma","ADDRESS":"106 S 28TH ST","CITY":"TACOMA","ZIP":"98402","DISTRICT":"NOT APPLICABLE","DIST_NO":"","TYPE":"COLLEGE","PHONE":"(253) 584-3778","WEBSITE":"https://schoolofurbanministry-tacoma.org/","PRS_ID":465,"GRADE":"Higher Education","X_COORD":1160124.6015,"Y_COORD":699691.752}},
      {"type":"Feature","geometry":{"type":"Point","coordinates":[-122.52131208121116,47.24649936313513]},"properties":{"OBJECTID":261,"NAME":"Tacoma Community College - Tacoma Campus","ADDRESS":"6501 S 19TH ST","CITY":"TACOMA","ZIP":"98466","DISTRICT":"NOT APPLICABLE","DIST_NO":"","TYPE":"COLLEGE","PHONE":"(253) 566-5000","WEBSITE":"https://www.tacomacc.edu/about/","PRS_ID":245,"GRADE":"Higher Education","X_COORD":1138433.3381,"Y_COORD":704121.8411}},
      {"type":"Feature","geometry":{"type":"Point","coordinates":[-122.48106796359309,47.261862051220184]},"properties":{"OBJECTID":273,"NAME":"University Of Puget Sound","ADDRESS":"1500 N WARNER ST","CITY":"TACOMA","ZIP":"98416","DISTRICT":"NOT APPLICABLE","DIST_NO":"","TYPE":"UNIVERSITY","PHONE":"(253) 879-3100","WEBSITE":"https://www.pugetsound.edu/","PRS_ID":252,"GRADE":"Higher Education","X_COORD":1148566.373,"Y_COORD":709469.9368}},
      {"type":"Feature","geometry":{"type":"Point","coordinates":[-122.43828053661741,47.24504511461952]},"properties":{"OBJECTID":274,"NAME":"University of Washington - Tacoma ( UWT )","ADDRESS":"1900 COMMERCE ST","CITY":"TACOMA","ZIP":"98402","DISTRICT":"NOT APPLICABLE","DIST_NO":"","TYPE":"UNIVERSITY","PHONE":"(253) 692-4400","WEBSITE":"http://www.tacoma.uw.edu/","PRS_ID":243,"GRADE":"Higher Education","X_COORD":1159036.5583,"Y_COORD":703074.0025}}
    ]};
        // add markers to map
        geojson.features.forEach(function(marker) {

          // create a HTML element for each feature
          var el = document.createElement('div');
          el.className = 'marker';

          // make a marker for each feature and add to the map
          new mapboxgl.Marker(el)
            .setLngLat(marker.geometry.coordinates)
            .setPopup(new mapboxgl.Popup()
               .setHTML("Name: " + "<b>" + marker.properties['NAME'] + '</b>' + "<br>" + "Address: " + "<b>" + marker.properties['ADDRESS']))
            .addTo(map2);
          });


//Tacoma boundary
      map2.on('load', function(){
      map2.addSource('Population', {
                "type": "geojson",
                "data": "Geojson/Tacoma.geojson"
            });
      map2.addLayer({
              "id":"Population_total",
              "type":"fill",
              "source":"Population",
              "paint": {
                  "fill-color": "white",
                  "fill-opacity": 0.3
              }
            });

        });

//Geocoder
      map2.addControl(
          new MapboxGeocoder({
          accessToken: mapboxgl.accessToken,
          mapboxgl: mapboxgl
          })
          );

//Zoom
      map2.addControl(new mapboxgl.NavigationControl());

</script>

</body>

</html>
